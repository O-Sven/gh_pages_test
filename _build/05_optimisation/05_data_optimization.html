---
redirect_from:
  - "/05-optimisation/05-data-optimization"
interact_link: content/05_optimisation/05_data_optimization.ipynb
kernel_name: python3
kernel_path: content/05_optimisation
has_widgets: false
title: |-
  Optimization
pagenum: 7
prev_page:
  url: /04_numpy/04_numpy_basics_solution.html
next_page:
  url: /05_optimisation/05_data_optimization_solution.html
suffix: .ipynb
search: data function curve given br scipy div x algorithm model font style minimization least squares fit width set polyfit polynomial fitting px analysis optimization minimize using define between parameters sum color green task numpys loadtxt routine access stored plot optimized gaussian float left python right img src images png best measured often points therefore describes should package examples here not numpy used n values squared simulation seen example above print y column functions modify overflow hidden hdata h bwinter semester bbr blukas arnold max bhler b fzjlogo buwlogo process selecting element regard criterion available alternatives contain noise makes describing minima

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Optimization</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div style="width: 100%; overflow: hidden;">
    <div style="width: 500px; float: left;"> 
        <h1>Data Analysis with Python</h1> <br>
        <b>Winter Semester 2018/2019</b><br>
        <b>Lukas Arnold and Max BÃ¶hler</b>
    </div>
    <div style="float:right;"> 
        <img src="images/fzj_logo.png" style="width:150px;"/>
        <img src="images/buw_logo.png" style="width:150px;"/>
    </div>
</div>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Optimization is the process of selecting the best element (with regard to some criterion) from some set of available alternatives.<br>
Measured data often contain noise, which makes the analysis of curve describing points (minima, maxima, turning points) complex. Therefore the aim of optimization is to find the best set of parameter that describes the given data and allows a simple analysing.
<br>
<br>
When working on data optimization with Python, one should use the package <em>SciPy</em>. It is a library (package) which contains modules for optimazation like curvefitting, minimization, etc.
<br>
<br></p>
<p>Examples and more detailed instructions how to use <em>SciPy</em> can be found here:
<a href="https://docs.scipy.org/doc/scipy/reference/">https://docs.scipy.org/doc/scipy/reference/</a></p>
<p><em>Note: If SciPy is not yet installed on your system, open the Anaconda prompt (or terminal on Unix systems) and type:</em></p>
<p><code>conda install scipy</code></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="NumPy-polyfit">NumPy polyfit<a class="anchor-link" href="#NumPy-polyfit"> </a></h3><p>"Polyfit" is a <em>numpy</em> function that computes a least squares polynomial for a given set of data. Polyfit actually generates the coefficients $(a_1, a_2, a_3, ... a_n)$ of the polynomial (which can be used to simulate a curve to fit the data) according to the degree $(n)$ specified.</p>
<p>$p(x) = a_1*x^n + a_2*x^{(n-1)}+...+a_n$</p>
<p>"Polyval" evaluates a polynomial for a given set of x values.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># Generate 100 x-values from -5 to 5</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># Create a parabola with noise</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># Compute the polynomials. Since we try to fit a parabola, the degree for polyfit is 2.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">y_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># Evaluate the fitting curve using polynomials from above</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y_p</span><span class="p">)</span>

<span class="n">poly_string</span> <span class="o">=</span> <span class="s2">&quot;$y = </span><span class="si">{:.2f}</span><span class="s2">*x^2 </span><span class="si">{:+.2f}</span><span class="s2">*x </span><span class="si">{:+.2f}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">poly_string</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SciPy-Minimize">SciPy Minimize<a class="anchor-link" href="#SciPy-Minimize"> </a></h3><p>Given data is often hard to describe using a polynomial function, which is why the polyfit function cannot be used. A common way to fit this kind of data is the so called <em>least-squares minimization curve fitting</em> algorithm.
<br>
<br></p>
<p>The procedure is as follows:</p>
<ol>
<li>Define a parametrized model function</li>
<li>Define a target function and calculate the Root Mean Squared Error between the model function and the given data</li>
<li>Use <em>scipy.optimize.minimize</em> for finding the parameters of the function which minimize the sum of squared errors (between model function and given data)</li>
</ol>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Example</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="c1"># Generate 200 x-values from 0 to 50</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># Create a non polynomial function -&gt; arctan</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Step 1: Parametrized function</span>

<span class="k">def</span> <span class="nf">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Step 2: Target function</span>

<span class="k">def</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span> <span class="c1"># Root Mean Squared Error</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">target_function</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Step 3: Minimize minimize the sum of squared errors</span>

<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">so</span>

<span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">1.8</span><span class="p">]</span> <span class="c1"># Starting values</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">so</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">target_function</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameter a1: </span><span class="si">{:.4f}</span><span class="s2">; a2: </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="-_Task-1:-Curve-fitting-automatization_-"><font color="green"> _Task 1: Curve fitting automatization_ </font><a class="anchor-link" href="#-_Task-1:-Curve-fitting-automatization_-"> </a></h3><ol>
<li>Use NumPy's .loadtxt() routine to access the data stored in data/simulation_00 and plot its content</li>
<li>Define the model function which describes the given data</li>
<li><p>Fit a curve using the least-squares minimization algorithm as seen in the example above and print out the optimized parameters</p>
</li>
<li><p>Automate the algorithm so that all simulation files in the data folder are analysed</p>
</li>
</ol>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Solution</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="-_Task-2:-Curve-fitting-of-measured-data_-"><font color="green"> _Task 2: Curve fitting of measured data_ </font><a class="anchor-link" href="#-_Task-2:-Curve-fitting-of-measured-data_-"> </a></h3><ol>
<li>Use NumPy's .loadtxt() routine to access the data stored in distance_oszilator.dat</li>
<li>Plot the data for x between 10 and 25 and hide all y-values &gt; 40.</li>
<li>Fit a curve using the least-squares minimization algorithm as seen in the example above and print out the optimized parameters</li>
</ol>
<p><em>Remark: For the model function, use the following parameterized function:</em><br>
$a_1*e^{(-x*a_2)}*sin((x-a_3)*a_4) + a_5$</p>
<p>(Damped oszilator)</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Solution</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="-_Task-3:-Curve-Fitting-by-a-Sum-of-Gaussians_-"><font color="green"> _Task 3: Curve Fitting by a Sum of Gaussians_ </font><a class="anchor-link" href="#-_Task-3:-Curve-Fitting-by-a-Sum-of-Gaussians_-"> </a></h3><p>This examples illustrates the automated identification of chemical reactions, here pyrolysis, in a TGA (thermogravimetirc analysis) experiment.</p>
<ol>
<li>Use NumPy's .loadtxt() routine to access the data stored in PMMA_kompakt_40K.csv</li>
<li>Plot column 0 against column 1</li>
<li>Use the least-squares minimization algorithm to fit a curve to the given data
<br></li>
</ol>
<p><em>Hints:</em></p>
<ul>
<li>Use the Gaussian function as a model for this problem $y = A\exp{\left(-\dfrac{(x-x_0)^2}{d^2}\right)}$</li>
<li>As you can see, the given dataset consists of several Gauss functions. Therefore you should modify the algorithm so that not a single Gaussian function is optimized, but the sum of 4 Gaussian functions.(Modify the traget_function)</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Solution</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

 


    </main>
    